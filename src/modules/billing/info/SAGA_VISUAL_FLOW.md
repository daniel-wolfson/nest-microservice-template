# Travel Booking Saga - Visual Flow Diagram

## Complete Flow Visualization

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          CLIENT REQUEST                                       â”‚
â”‚                  POST /travel-booking                                         â”‚
â”‚                  {userId, flight, hotel, car, totalAmount}                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     TravelBookingController                                   â”‚
â”‚                     â€¢ Validate request                                        â”‚
â”‚                     â€¢ Create BookTravelCommand                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      BookTravelHandler                                        â”‚
â”‚                      â€¢ Handle command                                         â”‚
â”‚                      â€¢ Invoke saga                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     TravelBookingSaga                                         â”‚
â”‚                     (Orchestrator)                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•©â•â•â•â•â•â•â•â•â•â•â•â•â•—
                    â•‘   SAGA EXECUTION FLOW   â•‘
                    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•¦â•â•â•â•â•â•â•â•â•â•â•â•â•
                                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          STEP 1: RESERVE FLIGHT                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ FlightService.reserveFlight()                                       â”‚    â”‚
â”‚  â”‚ â€¢ Generate reservation ID                                           â”‚    â”‚
â”‚  â”‚ â€¢ Simulate API call (1000ms)                                        â”‚    â”‚
â”‚  â”‚ â€¢ 10% failure rate                                                  â”‚    â”‚
â”‚  â”‚ â€¢ Return: {reservationId, confirmationCode, status, amount}         â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                            SUCCESS âœ“
                                 â”‚
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          STEP 2: RESERVE HOTEL                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ HotelService.reserveHotel()                                         â”‚    â”‚
â”‚  â”‚ â€¢ Generate reservation ID                                           â”‚    â”‚
â”‚  â”‚ â€¢ Simulate API call (1200ms)                                        â”‚    â”‚
â”‚  â”‚ â€¢ 10% failure rate                                                  â”‚    â”‚
â”‚  â”‚ â€¢ Return: {reservationId, confirmationCode, status, amount}         â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                            SUCCESS âœ“
                                 â”‚
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          STEP 3: RESERVE CAR                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ CarRentalService.reserveCar()                                       â”‚    â”‚
â”‚  â”‚ â€¢ Generate reservation ID                                           â”‚    â”‚
â”‚  â”‚ â€¢ Simulate API call (1500ms)                                        â”‚    â”‚
â”‚  â”‚ â€¢ 30% failure rate âš ï¸  (INTENTIONAL FOR DEMO)                      â”‚    â”‚
â”‚  â”‚ â€¢ Return: {reservationId, confirmationCode, status, amount}         â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                         â”‚
              SUCCESS âœ“                  FAILURE âœ—
                    â”‚                         â”‚
                    â–¼                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 4: PROCESS PAYMENT     â”‚   â”‚      COMPENSATION FLOW                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•— â”‚
â”‚  â”‚ Process payment        â”‚  â”‚   â”‚  â•‘  Execute in REVERSE order          â•‘ â”‚
â”‚  â”‚ â€¢ Simulate processing  â”‚  â”‚   â”‚  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚
â”‚  â”‚ â€¢ 5% failure rate      â”‚  â”‚   â”‚                                          â”‚
â”‚  â”‚ â€¢ Total amount         â”‚  â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚  â”‚ 3. CarRentalService.cancelCar()    â”‚ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚    â€¢ If car was reserved           â”‚ â”‚
               â”‚                    â”‚  â”‚    â€¢ Rollback car reservation      â”‚ â”‚
         SUCCESS âœ“                  â”‚  â”‚    â€¢ Log compensation              â”‚ â”‚
               â”‚                    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
               â–¼                    â”‚              â†“                           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  BOOKING CONFIRMED âœ…        â”‚   â”‚  â”‚ 2. HotelService.cancelHotel()      â”‚ â”‚
â”‚                              â”‚   â”‚  â”‚    â€¢ If hotel was reserved         â”‚ â”‚
â”‚  Return:                     â”‚   â”‚  â”‚    â€¢ Rollback hotel reservation    â”‚ â”‚
â”‚  â€¢ bookingId                 â”‚   â”‚  â”‚    â€¢ Log compensation              â”‚ â”‚
â”‚  â€¢ flightReservationId       â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â€¢ hotelReservationId        â”‚   â”‚              â†“                           â”‚
â”‚  â€¢ carRentalReservationId    â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â€¢ status: "confirmed"       â”‚   â”‚  â”‚ 1. FlightService.cancelFlight()    â”‚ â”‚
â”‚  â€¢ timestamp                 â”‚   â”‚  â”‚    â€¢ If flight was reserved        â”‚ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚    â€¢ Rollback flight reservation   â”‚ â”‚
                                    â”‚  â”‚    â€¢ Log compensation              â”‚ â”‚
                                    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
                                    â”‚              â†“                           â”‚
                                    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
                                    â”‚  â”‚  BOOKING COMPENSATED âš ï¸            â”‚ â”‚
                                    â”‚  â”‚                                    â”‚ â”‚
                                    â”‚  â”‚  Return:                           â”‚ â”‚
                                    â”‚  â”‚  â€¢ bookingId                       â”‚ â”‚
                                    â”‚  â”‚  â€¢ flightReservationId (if exists) â”‚ â”‚
                                    â”‚  â”‚  â€¢ hotelReservationId (if exists)  â”‚ â”‚
                                    â”‚  â”‚  â€¢ carRentalReservationId: null    â”‚ â”‚
                                    â”‚  â”‚  â€¢ status: "compensated"           â”‚ â”‚
                                    â”‚  â”‚  â€¢ errorMessage                    â”‚ â”‚
                                    â”‚  â”‚  â€¢ timestamp                       â”‚ â”‚
                                    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## State Transitions

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   INITIAL   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     âœ“      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     âœ“      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     âœ“      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   FLIGHT    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚    HOTEL     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚     CAR     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚   PAYMENT   â”‚
â”‚  RESERVED   â”‚            â”‚   RESERVED   â”‚            â”‚  RESERVED   â”‚            â”‚  PROCESSED  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚                          â”‚                           â”‚                           â”‚
       â”‚ âœ—                        â”‚ âœ—                         â”‚ âœ—                         â”‚ âœ—
       â”‚                          â”‚                           â”‚                           â”‚
       â–¼                          â–¼                           â–¼                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  INITIAL    â”‚            â”‚   FLIGHT     â”‚            â”‚   HOTEL     â”‚            â”‚     CAR     â”‚
â”‚  (NO COMP)  â”‚            â”‚ COMPENSATED  â”‚            â”‚ COMPENSATED â”‚            â”‚ COMPENSATED â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚                           â”‚                           â”‚
                                  â–¼                           â–¼                           â–¼
                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                           â”‚   INITIAL    â”‚            â”‚   FLIGHT     â”‚            â”‚   FLIGHT    â”‚
                           â”‚ COMPENSATED  â”‚            â”‚ COMPENSATED  â”‚            â”‚ COMPENSATED â”‚
                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                                                              â”‚                           â”‚
                                                              â–¼                           â–¼
                                                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                       â”‚   INITIAL    â”‚            â”‚    HOTEL     â”‚
                                                       â”‚ COMPENSATED  â”‚            â”‚ COMPENSATED  â”‚
                                                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                                                                          â”‚
                                                                                          â–¼
                                                                                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                                                   â”‚   INITIAL    â”‚
                                                                                   â”‚ COMPENSATED  â”‚
                                                                                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Compensation Decision Tree

```
                        Did Flight Succeed?
                              â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                   â”‚
                   YES                  NO
                    â”‚                   â”‚
                    â–¼                   â–¼
            Did Hotel Succeed?    [NO COMPENSATION]
                    â”‚             (Nothing to rollback)
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                   â”‚
         YES                  NO
          â”‚                   â”‚
          â–¼                   â–¼
    Did Car Succeed?    [Compensate Flight]
          â”‚             Cancel flight only
    â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
    â”‚           â”‚
   YES          NO
    â”‚           â”‚
    â–¼           â–¼
Did Payment   [Compensate Flight + Hotel]
  Succeed?    Cancel hotel, then flight
    â”‚
â”Œâ”€â”€â”€â”´â”€â”€â”€â”
â”‚       â”‚
YES     NO
â”‚       â”‚
â–¼       â–¼
[SUCCESS] [Compensate All]
          Cancel car, hotel, flight
          (in reverse order)
```

## Timing Diagram

```
Time â†’

Client          Controller       Handler          Saga            Flight      Hotel       Car         Payment
  â”‚                 â”‚                â”‚              â”‚               â”‚           â”‚          â”‚            â”‚
  â”œâ”€Requestâ”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚              â”‚               â”‚           â”‚          â”‚            â”‚
  â”‚                 â”œâ”€Commandâ”€â”€â”€â”€â”€â”€â”€>â”‚              â”‚               â”‚           â”‚          â”‚            â”‚
  â”‚                 â”‚                â”œâ”€Executeâ”€â”€â”€â”€â”€>â”‚               â”‚           â”‚          â”‚            â”‚
  â”‚                 â”‚                â”‚              â”œâ”€Reserveâ”€â”€â”€â”€â”€â”€>â”‚           â”‚          â”‚            â”‚
  â”‚                 â”‚                â”‚              â”‚   (1000ms)    â”‚           â”‚          â”‚            â”‚
  â”‚                 â”‚                â”‚              â”‚<â”€â”€Successâ”€â”€â”€â”€â”€â”¤           â”‚          â”‚            â”‚
  â”‚                 â”‚                â”‚              â”‚               â”‚           â”‚          â”‚            â”‚
  â”‚                 â”‚                â”‚              â”œâ”€Reserveâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚          â”‚            â”‚
  â”‚                 â”‚                â”‚              â”‚               â”‚ (1200ms)  â”‚          â”‚            â”‚
  â”‚                 â”‚                â”‚              â”‚<â”€â”€Successâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤          â”‚            â”‚
  â”‚                 â”‚                â”‚              â”‚               â”‚           â”‚          â”‚            â”‚
  â”‚                 â”‚                â”‚              â”œâ”€Reserveâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚            â”‚
  â”‚                 â”‚                â”‚              â”‚               â”‚           â”‚ (1500ms) â”‚            â”‚
  â”‚                 â”‚                â”‚              â”‚<â”€â”€Failure/Successâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤            â”‚
  â”‚                 â”‚                â”‚              â”‚               â”‚           â”‚          â”‚            â”‚
  â”‚                 â”‚                â”‚           â”Œâ”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚           â”‚          â”‚            â”‚
  â”‚                 â”‚                â”‚           â”‚  If Success:   â”‚ â”‚           â”‚          â”‚            â”‚
  â”‚                 â”‚                â”‚           â””â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚           â”‚          â”‚            â”‚
  â”‚                 â”‚                â”‚              â”œâ”€Processâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
  â”‚                 â”‚                â”‚              â”‚               â”‚           â”‚          â”‚  (1000ms)  â”‚
  â”‚                 â”‚                â”‚              â”‚<â”€â”€Successâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                 â”‚                â”‚              â”‚               â”‚           â”‚          â”‚            â”‚
  â”‚                 â”‚                â”‚           â”Œâ”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚           â”‚          â”‚            â”‚
  â”‚                 â”‚                â”‚           â”‚  If Failure:   â”‚ â”‚           â”‚          â”‚            â”‚
  â”‚                 â”‚                â”‚           â””â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚           â”‚          â”‚            â”‚
  â”‚                 â”‚                â”‚              â”œâ”€Cancelâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚            â”‚
  â”‚                 â”‚                â”‚              â”‚<â”€â”€OKâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤            â”‚
  â”‚                 â”‚                â”‚              â”œâ”€Cancelâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚          â”‚            â”‚
  â”‚                 â”‚                â”‚              â”‚<â”€â”€OKâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤          â”‚            â”‚
  â”‚                 â”‚                â”‚              â”œâ”€Cancelâ”€â”€â”€â”€â”€â”€â”€â”€>â”‚           â”‚          â”‚            â”‚
  â”‚                 â”‚                â”‚              â”‚<â”€â”€OKâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤           â”‚          â”‚            â”‚
  â”‚                 â”‚                â”‚              â”‚               â”‚           â”‚          â”‚            â”‚
  â”‚                 â”‚                â”‚<â”€Resultâ”€â”€â”€â”€â”€â”€â”¤               â”‚           â”‚          â”‚            â”‚
  â”‚                 â”‚<â”€Responseâ”€â”€â”€â”€â”€â”€â”¤              â”‚               â”‚           â”‚          â”‚            â”‚
  â”‚<â”€Responseâ”€â”€â”€â”€â”€â”€â”€â”¤                â”‚              â”‚               â”‚           â”‚          â”‚            â”‚
  â”‚                 â”‚                â”‚              â”‚               â”‚           â”‚          â”‚            â”‚

SUCCESS CASE (total ~4700ms):
- Flight: 1000ms
- Hotel: 1200ms
- Car: 1500ms
- Payment: 1000ms

COMPENSATION CASE (total ~3700ms + 1500ms compensation = ~5200ms):
- Flight: 1000ms
- Hotel: 1200ms
- Car: 1500ms (FAIL)
- Compensations: ~500ms each Ã— 3 = ~1500ms
```

## Service Failure Rates

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Service                           â”‚
â”‚                Failure Rates                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                    â”‚
â”‚  FlightService:        10%  â–“â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘            â”‚
â”‚  HotelService:         10%  â–“â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘            â”‚
â”‚  CarRentalService:     30%  â–“â–“â–“â–‘â–‘â–‘â–‘â–‘â–‘â–‘  âš ï¸        â”‚
â”‚  PaymentProcessing:     5%  â–“â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  â”‚
â”‚                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Overall Success Rate: ~55% (due to 30% car rental failure)
Compensation Trigger: ~45% of requests

Note: CarRentalService has intentionally high failure rate
      to demonstrate compensation flow frequently.
```

## Cost Breakdown (Example)

```
Total Amount: $2500.00

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Flight    40%   $1000.00  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  â”‚
â”‚  Hotel     35%   $ 875.00  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ   â”‚
â”‚  Car       25%   $ 625.00  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

If compensation occurs:
âœ— All reservations cancelled
âœ— No charges applied
âœ“ Customer notified of failure
```

## Logging Patterns

### Success Flow

```
[INFO]  Starting Travel Booking Saga: TRV-xxx
[INFO]  Step 1: Reserving Flight...
[INFO]  âœ“ Step 1 Complete: Flight Reserved
[INFO]  Step 2: Reserving Hotel...
[INFO]  âœ“ Step 2 Complete: Hotel Reserved
[INFO]  Step 3: Reserving Car...
[INFO]  âœ“ Step 3 Complete: Car Reserved
[INFO]  Step 4: Processing Payment...
[INFO]  âœ“ Step 4 Complete: Payment Processed
[INFO]  âœ… Travel Booking Saga Completed Successfully
```

### Compensation Flow

```
[INFO]  Starting Travel Booking Saga: TRV-xxx
[INFO]  Step 1: Reserving Flight...
[INFO]  âœ“ Step 1 Complete: Flight Reserved
[INFO]  Step 2: Reserving Hotel...
[INFO]  âœ“ Step 2 Complete: Hotel Reserved
[INFO]  Step 3: Reserving Car...
[ERROR] Car rental reservation failed
[ERROR] âŒ Travel Booking Saga Failed
[WARN]  ðŸ”„ Starting Compensation Process...
[WARN]  Compensating: Canceling hotel reservation
[INFO]  âœ“ Compensated: Hotel booking cancelled
[WARN]  Compensating: Canceling flight reservation
[INFO]  âœ“ Compensated: Flight booking cancelled
[INFO]  âœ… Compensation Process Completed
```

---

**Note**: All delays and failure rates are simulated for demonstration purposes.
In production, these would be actual external service calls with real latencies and failures.
